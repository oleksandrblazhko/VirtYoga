# Адаптація розділу вищої математики "Лінійна алгебра" до IT-проєкту "Віртуальна Йога"

## Вступ

Шановні студенти!

Сьогодні ми розглянемо, як абстрактні математичні поняття, зокрема матриці з лінійної алгебри, можуть бути потужним інструментом у ваших IT-проєктах. Багато хто з вас працює над проєктом "Віртуальна Йога", який використовує вебкамеру для аналізу поз. Давайте подивимося, як знання матриць може допомогти вам у вирішенні конкретних завдань цього проєкту.

**Мета нашої лекції** – не просто повторити теорію, а показати її практичне застосування, адаптувавши математичний апарат до ваших функціональних вимог. Ми перетворимо абстрактні `a[i,j]` на конкретні координати суглобів вашого тіла.

## 1. Функціональні вимоги до IT-проєкту "Віртуальна Йога"

Згідно з файлом `FunctionReq.md`, ваша програма повинна:
1.  Розпізнавати скелет людини за допомогою вебкамери та бібліотеки MediaPipe (33 суглоби).
2.  Отримувати 3D-координати (x, y, z) кожного суглоба.
3.  Порівнювати поточну позу користувача з еталонною позою з бази даних.
4.  Надавати рекомендації для корекції пози.
5.  Повідомляти про правильне виконання вправи.

**Ключове завдання**: математично описати позу людини та порівняти її з еталоном. І саме тут нам на допомогу приходять матриці.

## 2. Основи матричного числення

З курсу лекцій (`Math-lecture-1.txt`) ми знаємо, що матриця – це прямокутна таблиця чисел. У нашому випадку, елементами матриці будуть координати суглобів.

**Ключові операції**, які нам знадобляться:
*   **Транспонування**: зміна рядків і стовпців місцями.
*   **Множення матриць**: для складних перетворень.
*   **Підматриці**: для аналізу окремих частин тіла (наприклад, тільки рук або ніг).

## 3. Варіанти опису суглобів людини з використанням матриць

Поза людини – це набір координат 33 суглобів. Давайте розглянемо, як це можна представити у вигляді матриць.

### Варіант 1: Матриця координат суглобів (33x3)

Найпростіший спосіб – створити матрицю, де кожен рядок відповідає одному суглобу, а стовпці – його координатам (x, y, z).

`PoseMatrix =`
```
      x      y      z
[x_nose, y_nose, z_nose]      ; суглоб 0 (ніс)
[x_leye, y_leye, z_leye]      ; суглоб 1 (ліве око)
...
[x_rfoot, y_rfoot, z_rfoot]   ; суглоб 32 (індекс правої ноги)
```

**Переваги:**
*   **Простота та інтуїтивність**: легко зрозуміти, де які дані знаходяться.
*   **Легкість обчислень**: просто працювати з окремими суглобами, звертаючись до рядка матриці.

**Недоліки:**
*   **Обмеженість**: незручно виконувати складні геометричні перетворення (поворот, масштабування, переміщення) для всієї пози.

### Варіант 2: Матриця з однорідними координатами (33x4)

Для складних трансформацій в комп'ютерній графіці використовують однорідні координати. Ми додаємо ще один стовпець (w), який зазвичай дорівнює 1.

`PoseMatrix_H =`
```
      x      y      z      w
[x_nose, y_nose, z_nose,  1]
[x_leye, y_leye, z_leye,  1]
...
[x_rfoot, y_rfoot, z_rfoot, 1]
```

**Переваги:**
*   **Потужність**: дозволяє виконувати афінні перетворення (поворот, зсув, масштабування) шляхом множення на одну матрицю трансформації 4x4. Це корисно для нормалізації пози (наприклад, центрування скелета відносно початку координат).

**Недоліки:**
*   **Складність**: вимагає глибших знань лінійної алгебри та геометричних перетворень.

### Варіант 3: Матриця відносних векторів (матриця зв'язків)

Замість абсолютних координат, ми можемо зберігати вектори, що з'єднують пари суглобів. Наприклад, вектор від лівого плеча до лівого ліктя.

`ConnectionsMatrix =`
```
            dx     dy     dz
[x_elb_l - x_sh_l, y_elb_l - y_sh_l, z_elb_l - z_sh_l]  ; вектор "ліве плече -> лівий лікоть"
[x_wr_l - x_elb_l, y_wr_l - y_elb_l, z_wr_l - z_elb_l]  ; вектор "лівий лікоть -> ліве зап'ястя"
...
```

**Переваги:**
*   **Інваріантність до положення**: опис пози не залежить від того, де в кадрі знаходиться людина. Важливі лише кути та пропорції.
*   **Аналіз кутів**: дозволяє легко обчислювати кути між частинами тіла за допомогою скалярного добутку векторів.

**Недоліки:**
*   **Втрата інформації**: втрачається абсолютне положення тіла.

## 4. Проблема Z-координати та її вирішення

Вебкамери не є точними 3D-сканерами. Вони визначають координати `x` та `y` з високою точністю, але `z` (глибина) часто є розрахунковою і неточною.

### 4.1. Модифікована формула відстані

Щоб врахувати цю неточність, ми вводимо **ваговий коефіцієнт `w` (0 < w < 1)** для z-координати. Цей коефіцієнт буде знижувати вплив неточної z-координати на загальну оцінку.

Модифікована формула для обчислення відстані між двома суглобами (наприклад, еталонним `(x₁, y₁, z₁)` та поточним `(x₂, y₂, z₂)`):

**d = √[(x₂-x₁)² + (y₂-y₁)² + w * (z₂-z₁)²]**

де `w` – коефіцієнт довіри до z-координати.

### 4.2. Коефіцієнти довіри (w) та орієнтація камери

Значення `w` не є постійним. Воно залежить від пози та орієнтації камери.

*   **Фронтальна орієнтація (камера спереду)**:
    *   `x` та `y` координати розпізнаються добре.
    *   Рухи "вперед-назад" (зміна `z`) розпізнаються погано.
    *   **Рекомендований `w`**: 0.1 - 0.3.
    *   **Оптимально для поз**, де основні рухи відбуваються у фронтальній площині (наприклад, нахили вбік).

*   **Бокова орієнтація (камера збоку)**:
    *   `y` та `z` координати (умовно) розпізнаються добре, `x` – погано.
    *   **Рекомендований `w`**: 0.7 - 0.9 (оскільки `z` стає однією з основних координат у 2D-проекції).
    *   **Оптимально для поз**, де важливі рухи вперед-назад (наприклад, випади, як у Позі Воїна).

### 4.3. Рівні довіри до якості розпізнавання

Для кожної пози можна визначити загальний рівень довіри, базуючись на тому, наскільки добре вона розпізнається з певної орієнтації.

| Поза | Оптимальна орієнтація | Якість розпізнавання X, Y | Якість розпізнавання Z | Рівень довіри |
|---|---|---|---|---|
| Поза Дерева | Фронтальна | Висока | Низька | Високий |
| Поза Воїна I | Бокова | Середня | Середня | Середній |
| Поза Воїна II | Фронтальна | Висока | Низька | Високий |
| Поза Воїна III | Бокова | Середня | Висока (нога паралельно підлозі) | Високий |

## 5. Порівняння 2D та 3D аналізу

### 5.1. 2D аналіз (використовуючи тільки X, Y)

*   **Формула відстані**: `d = √[(x₂-x₁)² + (y₂-y₁)²]`
*   **Переваги**:
    *   Простота реалізації.
    *   Висока точність, оскільки використовуються найнадійніші дані.
    *   Ідеально для поз у фронтальній площині.
*   **Недоліки**:
    *   Повна втрата інформації про глибину.
    *   Неправильна оцінка поз, де важливі рухи вперед-назад (наприклад, чи достатньо глибокий випад у Позі Воїна).

### 5.2. 3D аналіз (з ваговим коефіцієнтом `w` для Z)

*   **Формула відстані**: `d = √[(x₂-x₁)² + (y₂-y₁)² + w * (z₂-z₁)²]`
*   **Переваги**:
    *   Враховує глибину, що дає більш повну картину пози.
    *   Дозволяє аналізувати складні пози, які неможливо оцінити в 2D.
    *   Гнучкість завдяки коефіцієнту `w`.
*   **Недоліки**:
    *   Складніший в реалізації.
    *   Результат залежить від правильного підбору коефіцієнта `w`.

**Висновок**: Для максимальної точності варто використовувати **гібридний підхід**. Для поз, що виконуються переважно у фронтальній площині, можна використовувати 2D-аналіз. Для поз з рухами по осі Z – 3D-аналіз з ретельно підібраним коефіцієнтом `w` та рекомендацією користувачу зайняти оптимальну орієнтацію відносно камери.

## 6. Аналіз Йога-вправ з використанням матриць

Розглянемо три позі Воїна (Вірабхадрасана).

---

### **Поза Воїна I (Virabhadrasana I)**

**Опис**: Одна нога попереду, зігнута в коліні під кутом 90 градусів. Інша нога позаду, пряма. Тулуб розвернутий вперед, руки підняті вгору, долоні разом.

**Оптимальна орієнтація**: Бокова (для контролю глибини випаду і прямої спини).

#### Матричний опис (Варіант 1: 33x3)

`Warrior_I_Matrix =`
```
       x      y      z
[  0.0,  1.8,  0.0]  ; ніс (приклад)
...
[  0.0,  0.9,  0.4]  ; ліве коліно (зігнуте)
[  0.0,  0.9, -0.6]  ; праве коліно (пряме)
[  0.0,  1.7,  0.1]  ; ліве зап'ястя
[  0.0,  1.7, -0.1]  ; праве зап'ястя
...
```
*Значення є умовними і слугують для ілюстрації.*

#### Приклад реальних значень кутів

*   **Кут у передньому коліні**: ~90° (між `вектором стегна` і `вектором гомілки`).
*   **Кут у задньому коліні**: ~180° (нога пряма).
*   **Кут у ліктях**: ~180° (руки прямі).
*   **Кут плечей відносно тулуба**: ~180° (руки підняті вгору).

---

### **Поза Воїна II (Virabhadrasana II)**

**Опис**: Ноги широко розставлені. Одна нога зігнута в коліні. Тулуб розвернутий вбік, руки розведені в сторони, паралельно підлозі.

**Оптимальна орієнтація**: Фронтальна (для контролю паралельності рук та положення тулуба).

#### Матричний опис (Варіант 1: 33x3)

`Warrior_II_Matrix =`
```
       x      y      z
[  0.0,  1.5,  0.0]  ; ніс
...
[ -0.8,  0.8,  0.0]  ; ліве коліно (зігнуте)
[  0.8,  0.8,  0.0]  ; праве коліно (пряме)
[ -1.0,  1.4,  0.0]  ; ліве зап'ястя
[  1.0,  1.4,  0.0]  ; праве зап'ястя
...
```

#### Приклад реальних значень кутів

*   **Кут у передньому коліні**: ~90°.
*   **Кут у плечах**: ~90° (між `вектором руки` і `вектором тулуба`).
*   **Кут у ліктях**: ~180°.
*   **Кут між руками**: ~180°.

---

### **Поза Воїна III (Virabhadrasana III)**

**Опис**: Поза на одній нозі. Тулуб і піднята нога паралельні підлозі. Руки витягнуті вперед.

**Оптимальна орієнтація**: Бокова (ключовий контроль паралельності тулуба та ноги до підлоги).

#### Матричний опис (Варіант 1: 33x3)

`Warrior_III_Matrix =`
```
       x      y      z
...
[  0.0,  0.9,  0.0]  ; ліве стегно (опорне)
[  0.0,  0.9,  0.0]  ; праве стегно (на одній лінії з тулубом)
[  0.8,  0.9,  0.0]  ; праве коліно (підняте)
[  1.2,  0.9,  0.0]  ; права щиколотка (піднята)
...
```
*Тут вісь Y умовно йде вздовж опорної ноги, а X - вздовж тулуба.*

#### Приклад реальних значень кутів

*   **Кут в опорному коліні**: ~180°.
*   **Кут в тазостегновому суглобі (між тулубом і піднятою ногою)**: ~180°.
*   **Кут між тулубом і опорною ногою**: ~90°.

## 7. Підматриці та комбіновані матриці

### Підматриці для аналізу частин тіла

Замість аналізувати всю матрицю з 33 суглобів, можна виділяти **підматриці** для конкретних завдань.

**Приклад: Аналіз положення рук у Позі Воїна II**

Ми можемо створити підматрицю, яка містить тільки суглоби рук:

`ArmsMatrix =`
```
[x_sh_l, y_sh_l, z_sh_l]  ; ліве плече
[x_elb_l, y_elb_l, z_elb_l] ; лівий лікоть
[x_wr_l, y_wr_l, z_wr_l]   ; ліве зап'ястя
[x_sh_r, y_sh_r, z_sh_r]  ; праве плече
...
```
Це дозволяє сфокусувати аналіз на тому, чи прямі руки і чи паралельні вони підлозі.

### Комбіновані (блокові) матриці

Ми можемо комбінувати різні типи даних в одну велику блокову матрицю для комплексного аналізу.

`ComplexPoseMatrix =`
```
[ PoseMatrix_H (33x4) | AnglesVector (33x1) ]
```
де `PoseMatrix_H` – матриця однорідних координат, а `AnglesVector` – вектор-стовпець з розрахованими кутами в кожному суглобі.

Така структура дозволяє одночасно аналізувати і положення, і кути, що є дуже потужним підходом.

## 8. Матриці з реальними значеннями (приклад)

Давайте заповнимо матрицю для **Пози Воїна II** більш реалістичними (але все ще нормалізованими) даними. Припустимо, що центр тазу (hip) знаходиться в точці (0, 0.9, 0), а відстань між плечима - 0.4 одиниці.

`Warrior_II_Real_Matrix (вибрані суглоби):`
```
       x      y      z
[  0.00, 1.60, 0.05] ; 0 - ніс
[ -0.20, 1.55, 0.00] ; 11 - ліве плече
[  0.20, 1.55, 0.00] ; 12 - праве плече
[ -0.80, 1.55, 0.00] ; 13 - лівий лікоть
[  0.80, 1.55, 0.00] ; 14 - правий лікоть
[ -1.20, 1.55, 0.00] ; 15 - ліве зап'ястя
[  1.20, 1.55, 0.00] ; 16 - праве зап'ястя
[ -0.15, 0.90, 0.00] ; 23 - ліве стегно
[  0.15, 0.90, 0.00] ; 24 - праве стегно
[ -0.60, 0.40, 0.00] ; 25 - ліве коліно (зігнуте)
[  0.60, 0.90, 0.00] ; 26 - праве коліно (пряме)
[ -0.60, 0.00, 0.00] ; 27 - ліва щиколотка
[  0.60, 0.00, 0.00] ; 28 - права щиколотка
```
Ця матриця може слугувати **еталоном** у вашій базі даних для порівняння з позою користувача.

## Висновок

Ми побачили, як теорія матриць з курсу вищої математики знаходить пряме застосування в сучасному IT-проєкті. Використання матриць дозволяє:
*   **Структуровано** представляти складні дані (пози людини).
*   **Математично точно** аналізувати та порівнювати пози.
*   **Ефективно** вирішувати проблеми, пов'язані з обмеженнями обладнання (неточність z-координати).
*   **Гнучко** підходити до аналізу, використовуючи підматриці та комбіновані матриці.

Сподіваюся, цей приклад надихне вас глибше вивчати математику і бачити в ній не просто абстрактні формули, а потужний інструмент для реалізації ваших ідей.
