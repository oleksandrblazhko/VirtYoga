# Експертний аналіз та адаптація вищої математики для IT-проєкту "Віртуальна Йога"

## Вступ
Як експерт у вищій математиці та проектно-орієнтованому навчанні, я маю за мету адаптувати принципи матричної алгебри до реальних завдань IT-проєкту "Віртуальна Йога". Це дозволить студентам побачити практичне застосування теоретичних знань і підвищити їх мотивацію до вивчення вищої математики. Основна ідея полягає в тому, щоб замість абстрактних прикладів використовувати дані з їхніх власних IT-проєктів для ілюстрації математичних концепцій.

## 1. Аналіз функціональних вимог до IT-проєкту "Віртуальна Йога"
Проєкт "Віртуальна Йога" передбачає розпізнавання скелета людини за допомогою вебкамери та бібліотеки Mediapipe, яка відстежує 33 суглоби у 3D-просторі (x, y, z). Програма порівнює поточну позу користувача з еталонними позами з бази даних та надає зворотний зв'язок у реальному часі.

**Перелік суглобів Mediapipe (номер-назва):**
0-nose, 1-left eye (inner), 2-left eye, 3-left eye (outer), 4-right eye (inner), 5-right eye, 6-right eye (outer), 7-left ear, 8-right ear, 9-mouth (left), 10-mouth (right), 11-left shoulder, 12-right shoulder, 13-left elbow, 14-right elbow, 15-left wrist, 16-right wrist, 17-left pinky, 18-right pinky, 19-left index, 20-right index, 21-left thumb, 22-right thumb, 23-left hip, 24-right hip, 25-left knee, 26-right knee, 27-left ankle, 28-right ankle, 29-left heel, 30-right heel, 31-left foot index, 32-right foot index

**Анатомічні зв'язки між суглобами скелету (номери):**
0-4, 4-5, 5-6, 6-8, 0-1, 1-2, 2-3, 3-7, 10-9,
18-20, 18-16, 20-16, 22-16, 16-14, 14-12,
19-17, 15-19, 15-17, 21-15, 13-21, 11-13,
12-11, 24-23,
12-24, 24-26, 26-28, 28-32, 28-30, 32-30,
11-23, 23-25, 25-27, 27-31, 27-29, 29-31

## 2. Математичний базис: Числові матриці
Матриці є фундаментальним інструментом лінійної алгебри для представлення та обробки структурованих даних. У контексті "Віртуальної Йоги" вони дозволяють ефективно зберігати координати суглобів, кути між ними, а також виконувати операції для порівняння поз та визначення відхилень.

**Основні поняття:**
*   **Матриця:** Прямокутна таблиця чисел (або інших елементів). Розмір `m x n` означає `m` рядків і `n` стовпців.
*   **Елементи матриці:** Позначаються `aij`, де `i` – номер рядка, `j` – номер стовпця.
*   **Операції над матрицями:**
    *   **Додавання/Віднімання:** Матриці повинні мати однаковий розмір. Операція виконується поелементно.
    *   **Множення на скаляр:** Кожен елемент матриці множиться на скаляр (число).
    *   **Множення матриць:** Матрицю `A` розміру `m x s` можна помножити на матрицю `B` розміру `s x n`, отримавши матрицю `C` розміру `m x n`. Число стовпців першої матриці має дорівнювати числу рядків другої. Елемент `cij` розраховується як сума добутків елементів `i`-го рядка `A` на відповідні елементи `j`-го стовпця `B`.
*   **Визначники:** Число, що асоціюється з квадратною матрицею, використовується для перевірки її оборотності та вирішення систем лінійних рівнянь (наприклад, за правилом Крамера).

## 3. Матричний опис суглобів людини
Розглянемо декілька варіантів представлення положення суглобів за допомогою матриць, враховуючи вимоги проєкту та обмеження.

### Варіант 1: Матриця координат суглобів (Absolute Coordinate Matrix)
Це найпростіший спосіб представлення даних, отриманих від Mediapipe.

*   **Опис:** Кожен рядок матриці відповідає одному суглобу, а стовпці – його тривимірним координатам (x, y, z).
*   **Розмірність:** `33 x 3` (33 суглоби, 3 координати).
*   **Переваги:**
    *   Пряме представлення вихідних даних Mediapipe.
    *   Легкість інтерпретації абсолютного положення кожного суглоба.
    *   Простота реалізації.
*   **Недоліки:**
    *   Сильно залежить від положення людини у кадрі (трансляція та обертання).
    *   Важко порівнювати пози, якщо людина знаходиться в різних місцях або орієнтаціях відносно камери.
    *   Висока чутливість до шуму в даних, особливо по осі z.

**Приклад:**
```
M_coords =
  [[x_nose, y_nose, z_nose],
   [x_left_eye_inner, y_left_eye_inner, z_left_eye_inner],
   ...
   [x_right_foot_index, y_right_foot_index, z_right_foot_index]]
```

### Варіант 2: Матриця відносних векторів між суглобами (Relative Vector Matrix)
Для зменшення залежності від абсолютного положення можна використовувати вектори між анатомічно зв'язаними суглобами.

*   **Опис:** Матриця містить вектори, що з'єднують пов'язані суглоби. Наприклад, вектор від правого плеча до правого ліктя.
*   **Розмірність:** Залежить від кількості обраних зв'язків. Якщо врахувати всі анатомічні зв'язки Mediapipe (близько 30), то це буде `~30 x 3`.
*   **Переваги:**
    *   Інваріантність до трансляції тіла у просторі.
    *   Часткова інваріантність до загального обертання тіла (якщо вектори нормалізуються або порівнюються їх напрямки).
    *   Більш стабільний опис пози.
*   **Недоліки:**
    *   Все ще чутлива до обертання тіла.
    *   Координати z все ще впливають на довжину та напрямок векторів.
    *   Для повного опису пози може знадобитися додаткова інформація про орієнтацію.

**Приклад (фрагмент):**
```
M_vectors =
  [[x_shoulder_L - x_hip_L, y_shoulder_L - y_hip_L, z_shoulder_L - z_hip_L],  // Вектор лівого боку тулуба
   [x_elbow_L - x_shoulder_L, y_elbow_L - y_shoulder_L, z_elbow_L - z_shoulder_L], // Вектор лівого плеча
   ...
   [x_ankle_L - x_knee_L, y_ankle_L - y_knee_L, z_ankle_L - z_knee_L]] // Вектор лівої гомілки
```

### Варіант 3: Матриця кутів між зв'язаними суглобами (Angle Matrix) з урахуванням анатомічних зв'язків
Урахування анатомічних зв'язків між суглобами підвищує надійність для опису поз, оскільки кути є інваріантними до положення та обертання тіла в цілому, 
що дозволяє оптимізувати матрицю.

*   **Опис:** Матриця містить значення кутів, утворених трьома послідовними суглобами, які формують "ланцюг" (наприклад, плече-лікоть-зап'ястя).
*   **Анатомічні зв'язки та оптимізація:** Завдяки анатомічним зв'язкам, багато кутів можуть бути залежними або надлишковими. Наприклад, для суглоба `12` (праве плече), зв'язаного з `11` (ліве плече), `14` (правий лікоть) та `24` (праве стегно), ми можемо розглянути кути `11-12-14`, `14-12-24`, `11-12-24`. Однак, якщо ми знаємо два з цих кутів і припустимо, що суглоби знаходяться в одній площині, третій кут може бути виведений або він буде менш інформативним. Метою є вибір мінімального набору незалежних кутів, які однозначно визначають позу. Це зменшує розмірність матриці та складність алгоритму обробки.
    *   **Приклад оптимізації:** Замість зберігання всіх трьох кутів навколо суглоба 12, ми можемо зосередитися на ключових кутах, що визначають розкриття плеча. Наприклад, кут між `14-12` та `12-24` є критичним для визначення положення руки відносно тулуба. Кут `11-12-14` (ліве плече - праве плече - правий лікоть) може бути важливим для оцінки симетрії, але для *внутрішньої* конфігурації правої руки він менш пріоритетний.
    *   Також можна врахувати, що деякі суглоби (наприклад, пальці рук і ніг) мають менше анатомічних ступенів свободи і їхні кути можуть бути агреговані або представлені простіше.
*   **Розмірність:** Значно менша, ніж у матриці координат, залежить від кількості обраних незалежних кутів. Наприклад, близько 15-20 ключових кутів.
*   **Переваги:**
    *   Інваріантність до положення та загального обертання тіла.
    *   Пряме відображення конфігурації пози.
    *   Зниження розмірності та обчислювальної складності завдяки оптимізації кутів.
*   **Недоліки:**
    *   Обчислення кутів з 3D-координат може бути чутливим до шуму.
    *   Втрата інформації про абсолютний розмір тіла.

**Приклад (фрагмент оптимізованої матриці кутів):**
```
M_angles =
  [[angle(11-13-15)], // Кут лівого ліктя (плече-лікоть-зап'ястя)
   [angle(12-14-16)], // Кут правого ліктя
   [angle(23-25-27)], // Кут лівого коліна
   [angle(24-26-28)], // Кут правого коліна
   [angle(11-23-25)], // Кут лівого стегна (тулуб-стегно-коліно)
   [angle(12-24-26)], // Кут правого стегна
   [angle(23-11-12)], // Кут нахилу тулуба (між лівим стегном, лівим плечем, правим плечем)
   ... // Інші ключові кути, мінімізовані завдяки залежностям
  ]
```

### Обмеження вебкамери та коефіцієнти довіри для z-координати
Вебкамери часто мають значно меншу точність при визначенні z-координати (глибини) порівняно з x та y координатами. Це необхідно враховувати в аналізі поз.

*   **Коефіцієнт довіри (w):** Вводимо ваговий коефіцієнт `w` для z-координати, де `w < 1`. Це дозволить зменшити вплив менш надійних даних на загальну оцінку.
*   **Визначення w:**
    *   **Емпірично:** Шляхом тестування та калібрування з різними вебкамерами та умовами освітлення. Наприклад, `w = 0.5` або `w = 0.2`.
    *   **Динамічно:** `w` може змінюватися залежно від відстані об'єкта до камери (чим далі, тим менша довіра до z) або навіть від якості освітлення.

### Оптимальна орієнтація щодо камери для максимальної точності розпізнавання
Орієнтація людини відносно камери істотно впливає на точність розпізнавання:

*   **Фронтальна орієнтація:** Ідеальна для поз, де основні рухи та розкриття відбуваються в площині XY (паралельно екрану). Наприклад, для оцінки симетрії рук та ніг, розкриття грудної клітки.
*   **Бокова орієнтація:** Краща для поз, що вимагають точного відстеження глибини або мають значні рухи в площині XZ (від/до камери). Наприклад, для визначення прогинів спини, витягування рук вперед. Однак, може призвести до перекриття суглобів, зменшуючи точність.
*   **Орієнтація під кутом:** Компроміс, який може бути ефективним для багатьох поз, але потребує більш складних алгоритмів обробки.

**Приклад:** Для "Пози Воїна I" оптимальною може бути орієнтація під невеликим кутом до камери або фронтальна, що дозволяє добре бачити положення обох рук, ніг та тулуба.

### Рівні довіри до якості розпізнавання для кожної пози
Рівень довіри – це метрика, яка вказує на впевненість системи в тому, наскільки точно поточна поза користувача відповідає еталонній. Вона може бути числом від 0 до 1.

*   **Фактори, що впливають:**
    *   **Складність пози:** Складніші пози, з більшою кількістю перекриттів або нестандартними кутами, матимуть нижчий початковий рівень довіри.
    *   **Якість вхідного відео:** Освітлення, роздільна здатність камери, наявність перешкод, одяг.
    *   **Досвід користувача:** Новачки можуть виконувати рухи менш плавно, що впливає на стабільність розпізнавання.
*   **Використання:** Цей рівень довіри може бути використаний для адаптації чутливості системи, або для інформування користувача про можливі неточності.

### Модифікована формула відстані з урахуванням вагового коефіцієнта для z-координати
Для оцінки "відстані" між суглобами еталонної та поточної пози, ми можемо використати модифіковану евклідову відстань.

*   **Формула:** `d = √[(x₂-x₁)² + (y₂-y₁)² + w(z₂-z₁)²]`, де `w` – ваговий коефіцієнт (w < 1) для z-координати.

*   **Варіанти аналізу та їх порівняння:**
    *   **2D-аналіз (x, y):**
        *   **Опис:** Ігнорується z-координата або використовується `w=0`. Відстань розраховується лише за площинними координатами: `d = √[(x₂-x₁)² + (y₂-y₁)²]`.
        *   **Переваги:** Висока стійкість до неточностей z-кокоординат; менша обчислювальна складність. Найкраще підходить для поз, які переважно площинні (наприклад, розведення рук в сторони).
        *   **Недоліки:** Втрата інформації про глибину, що може бути критичним для об'ємних поз (наприклад, скручування тулуба або витягування рук вперед/назад). Точність розпізнавання для 2D-варіантів буде нижчою для поз з великим зміщенням по осі Z.
    *   **3D-аналіз (x, y, wz) з ваговим коефіцієнтом w:**
        *   **Опис:** Використовується повна 3D-інформація, але z-складова зважується за допомогою `w < 1`.
        *   **Переваги:** Надає повнішу картину пози, дозволяє оцінювати глибину та об'ємні рухи. Ваговий коефіцієнт зменшує вплив неточних даних z, зберігаючи при цьому певну інформацію про глибину. Точність розпізнавання для 3D-варіантів буде вищою для об'ємних поз, порівняно з 2D-аналізом.
        *   **Недоліки:** Все ще залежить від точності z, хоча і зважено. Вища обчислювальна складність порівняно з 2D.
    *   **Порівняння точності розпізнавання:**
        *   Для **площинних поз**, де рухи переважно відбуваються в площині x-y (наприклад, T-поза), 2D-аналіз може бути достатнім і навіть кращим через свою стійкість.
        *   Для **об'ємних поз**, де важлива глибина (наприклад, скручування, Воїн III з витягнутими руками), 3D-аналіз з ваговим коефіцієнтом є обов'язковим для коректної оцінки, незважаючи на потенційну похибку по z. Загалом, 3D-аналіз з `w` пропонує кращий компроміс між повнотою даних та стійкістю до шуму.

## 4. Приклади для Йога-вправ

Розглянемо три пози Воїна: Воїн I (Virabhadrasana I), Воїн II (Virabhadrasana II), Воїн III (Virabhadrasana III). Для кожної пози наведемо текстовий опис, матричний опис, приклади значень кутів, комбінованих матриць та підматриць, а також обговоримо переваги та недоліки.

### 4.1. Поза Воїна I (Virabhadrasana I)
**Текстовий опис:** Стоячи, одна нога виставлена вперед, коліно зігнуте під кутом 90 градусів, стегно паралельно підлозі. Задня нога пряма, стопа розвернута під кутом приблизно 45-60 градусів. Таз закритий (дивиться вперед). Руки витягнуті вгору, долоні з'єднані або паралельні. Погляд спрямований вперед.

**Оптимальна орієнтація щодо камери:** Фронтальна або під невеликим кутом (15-30 градусів) до камери. Це дозволить чітко бачити розкриття тазу (чи його "закриття"), положення рук та кути в колінах.

**Матричний опис (з урахуванням анатомічних зв'язків та оптимізації):**

1.  **Матриця координат суглобів (фрагмент з реалістичними значеннями):**
    *   Розмірність: `33 x 3` (x, y, z)
    *   Приклад (умовні нормалізовані координати, де центр тіла ~ (0,0,0)):
    ```
    M_coords_Warrior1 =
      [...
       [0.2,  0.5,  0.1],  // 11 - left shoulder
       [-0.2, 0.5,  0.1],  // 12 - right shoulder
       [0.2,  0.0,  0.0],  // 23 - left hip
       [-0.2, 0.0, -0.2],  // 24 - right hip (зміщення назад для правої ноги)
       [0.2, -0.5,  0.0],  // 25 - left knee
       [-0.3, -0.4, -0.4], // 26 - right knee
       [0.2, -1.0,  0.0],  // 27 - left ankle
       [-0.4, -0.8, -0.6], // 28 - right ankle
       ...
      ]
    ```

2.  **Матриця кутів, оптимізована через урахування анатомічних зв'язків:**
    *   Розмірність: Набагато менша, ніж `33 x 3`. Ми обираємо ключові незалежні кути.
    *   **Ключові кути для Воїна I:**
        *   **Кути колін:**
            *   Ліве коліно (23-25-27): ~90 градусів.
            *   Праве коліно (24-26-28): ~170-180 градусів (майже пряма нога).
        *   **Кути стегон:**
            *   Ліве стегно (11-23-25 або 24-23-25): ~180 градусів (тулуб-стегно-коліно, якщо дивитися збоку). Фронтально, кут розкриття стегна 23-24-26 буде близьким до 0 (таз "закритий").
            *   Праве стегно (12-24-26 або 23-24-26): аналогічно.
        *   **Кути плечей:**
            *   Лівий лікоть (11-13-15): ~170-180 градусів (руки прямі).
            *   Правий лікоть (12-14-16): ~170-180 градусів.
            *   Підняття рук (кут між вектором тулуба 23-11 та вектором плеча 11-13): ~30-45 градусів від вертикалі.
    *   **Оптимізація через урахування анатомічних зв'язків:** Замість трьох кутів навколо стегна (наприклад, 11-23-24, 23-24-26, 11-23-25), ми можемо зосередитися на:
        *   Куті згинання коліна (23-25-27) для передньої ноги.
        *   Куті розгинання коліна (24-26-28) для задньої ноги.
        *   Куті між вектором тулуба (наприклад, від 23 до 11) та вектором стегна (23 до 25), щоб оцінити нахил тулуба.
        *   Куті між лівим і правим стегном (23-24) відносно поздовжньої осі тіла, щоб оцінити "закритість" тазу.
        *   Кути витягнутих рук (11-13-15, 12-14-16) та їх підняття.
    *   Це дозволяє уникнути надмірності. Наприклад, якщо ми знаємо кути в колінах і стегнах, а також "закритість" тазу, положення щиколоток і стоп буде визначено з високою точністю.
    *   Приклад реальних значень кутів (у градусах) для правильної пози:
    ```
    M_angles_Warrior1 =
      [[angle(23-25-27), 90],   // Ліве коліно
       [angle(24-26-28), 175],  // Праве коліно
       [angle(11-13-15), 175],  // Лівий лікоть
       [angle(12-14-16), 175],  // Правий лікоть
       [angle(11-23-25), 90],  // Згинання лівого стегна відносно тулуба (Ліве плече - Ліве стегно - Ліве коліно)
       [angle(11-23-24), 5],   // Обертання тазу (Ліве плече - Ліве стегно - Праве стегно)
       [angle(23-11-13), 160], // Підняття лівого плеча (Ліве стегно - Ліве плече - Лівий лікоть)
       [angle(24-12-14), 160]  // Підняття правого плеча (Праве стегно - Праве плече - Правий лікоть)
      ]
    ```
    *   **Переваги матриці кутів:** Інваріантність до положення та обертання. Висока стійкість до змін у розмірах людини.
    *   **Недоліки:** Обчислення кутів може бути складнішим та чутливішим до похибок у 3D-координатах, особливо якщо суглоби майже вирівняні.

**Комбінована матриця для аналізу пози:**
Можна створити комбіновану матрицю, яка включає як ключові координати (наприклад, центр мас, координати голови), так і вектори та кути. Це дозволить використовувати переваги обох підходів.
*   Наприклад, перші кілька рядків можуть бути координатами носа, центру стегон, а наступні – ключовими кутами.
*   ```
    M_combined_Warrior1 =
      [[x_nose, y_nose, z_nose],
       [x_hip_center, y_hip_center, z_hip_center], // Вирахуваний центр стегон
       [angle(23-25-27), 90],
       [angle(11-13-15), 175],
       ...
      ]
    ```

**Приклад підматриць для аналізу конкретних частин тіла:**
Для детального аналізу конкретних частин тіла можна виділяти підматриці.

*   **Підматриця лівої ноги:**
    ```
    M_sub_left_leg =
      [[x_left_hip, y_left_hip, z_left_hip],
       [x_left_knee, y_left_knee, z_left_knee],
       [x_left_ankle, y_left_ankle, z_left_ankle],
       [x_left_foot_index, y_left_foot_index, z_left_foot_index]]
    ```
*   **Підматриця кутів правої руки:**
    ```
    M_sub_angles_right_arm =
      [[angle(12-14-16), 175], // Кут ліктя
       [angle(24-12-14), 160]] // Кут відведення правого плеча (Праве стегно - Праве плече - Правий лікоть)
    ```

### 4.2. Поза Воїна II (Virabhadrasana II)
**Текстовий опис:** Стоячи, одна нога виставлена вперед, коліно зігнуте під кутом 90 градусів, стегно паралельно підлозі. Задня нога пряма, стопа перпендикулярна до передньої стопи (розвернута на 90 градусів). Таз відкритий (дивиться вбік). Руки витягнуті в сторони, паралельно підлозі. Погляд спрямований поверх передньої руки.

**Оптимальна орієнтація щодо камери:** Фронтальна, або під невеликим кутом до передньої ноги. Таз відкритий, тому фронтальний вигляд дозволить краще оцінити розкриття стегон і положення рук.

**Матричний опис (з урахуванням анатомічних зв'язків та оптимізації):**

1.  **Матриця координат суглобів (фрагмент з реалістичними значеннями):**
    ```
    M_coords_Warrior2 =
      [...
       [0.2,  0.5,  0.0],  // 11 - left shoulder
       [-0.2, 0.5,  0.0],  // 12 - right shoulder
       [0.3,  0.0,  0.0],  // 23 - left hip
       [-0.3, 0.0,  0.0],  // 24 - right hip
       [0.3, -0.5,  0.0],  // 25 - left knee
       [-0.5, -0.1,  0.0], // 26 - right knee
       [0.3, -1.0,  0.0],  // 27 - left ankle
       [-0.7, -0.1,  0.0], // 28 - right ankle
       ...
      ]
    ```

2.  **Матриця кутів, оптимізована через урахування анатомічних зв'язків:**
    *   **Ключові кути для Воїна II:**
        *   **Кути колін:**
            *   Ліве коліно (23-25-27): ~90 градусів.
            *   Праве коліно (24-26-28): ~170-180 градусів (пряма нога).
        *   **Кути стегон:**
            *   Розкриття тазу: Кут між лівим (23-25) та правим (24-26) стегнами, якщо дивитися зверху, буде близьким до 90 градусів. Кут між вектором 23-24 та площиною XY.
        *   **Кути плечей:**
            *   Лівий лікоть (11-13-15): ~170-180 градусів (рука пряма).
            *   Правий лікоть (12-14-16): ~170-180 градусів.
            *   Розведення рук: Кут між вектором 11-13 та 12-14 відносно тулуба буде близьким до 180 градусів (руки витягнуті в сторони).
    *   **Оптимізація через урахування анатомічних зв'язків:** Для "Пози Воїна II" критично важливим є "відкриття" тазу та симетричне розведення рук. Замість трьох кутів навколо тазостегнового суглоба (наприклад, 11-23-24, 23-24-26, 11-23-25), ми можемо зосередитися на:
        *   Куті згинання коліна передньої ноги (23-25-27).
        *   Куті між вектором тулуба (наприклад, від 23 до 11) та вектором стегна задньої ноги (24 до 26), що визначає вирівнювання задньої ноги.
        *   Куті "відкритості" тазу (наприклад, проекція кута 23-24 на горизонтальну площину).
        *   Кути в ліктях (11-13-15, 12-14-16) та кути відведення плечей (кут між вектором тулуба 23-11 та вектором плеча 11-13).
    *   Приклад реальних значень кутів (у градусах) для правильної пози:
    ```
    M_angles_Warrior2 =
      [[angle(23-25-27), 90],   // Ліве коліно
       [angle(24-26-28), 175],  // Праве коліно
       [angle(11-13-15), 175],  // Лівий лікоть
       [angle(12-14-16), 175],  // Правий лікоть
       [angle(23-24-26), 85],   // "Відкриття" тазу (Ліве стегно - Праве стегно - Праве коліно)
       [angle(23-11-13), 90],  // Відведення лівого плеча (Ліве стегно - Ліве плече - Лівий лікоть)
       [angle(24-12-14), 90]   // Відведення правого плеча (Праве стегно - Праве плече - Правий лікоть)
      ]
    ```

**Комбінована матриця для аналізу пози:**
Аналогічно Воїну I, комбінована матриця може включати ключові координати (центр мас) та кути. Особливо важливо включити кути, що характеризують розкриття тазу та симетрію розведених рук.

**Приклад підматриць для аналізу конкретних частин тіла:**
*   **Підматриця верхнього плечового поясу:**
    ```
    M_sub_upper_body_angles =
      [[angle(11-13-15), 175],
       [angle(12-14-16), 175],
       [angle(23-11-13), 90], // Відведення лівого плеча (Ліве стегно - Ліве плече - Лівий лікоть)
       [angle(24-12-14), 90], // Відведення правого плеча (Праве стегно - Праве плече - Правий лікоть)
       [angle(23-11-12), 178]] // Кут між площинами лівої та правої руки (Ліве стегно - Ліве плече - Праве плече)
    ```

### 4.3. Поза Воїна III (Virabhadrasana III)
**Текстовий опис:** Балансуюча поза. Одна нога опорна, пряма або злегка зігнута. Інша нога витягнута назад, паралельно підлозі, стопа активна. Тулуб нахилений вперед, паралельно підлозі. Руки витягнуті вперед, паралельно підлозі (або долоні з'єднані). Голова, тулуб і витягнута нога утворюють одну пряму лінію.

**Оптимальна орієнтація щодо камери:** Бокова орієнтація є оптимальною. Це дозволить максимально точно відстежити кути нахилу тулуба, витягування ноги та рук, а також контроль балансу. Хоча z-координата менш точна, для цієї пози глибина є критичною.

**Матричний опис (з урахуванням анатомічних зв'язків та оптимізації):**

1.  **Матриця координат суглобів (фрагмент з реалістичними значеннями):**
    *   Приклад (бокова орієнтація, права нога опорна, ліва витягнута):
    ```
    M_coords_Warrior3 =
      [...
       [0.0,  0.5,  0.7],  // 11 - left shoulder (витягнута вперед)
       [0.0,  0.5,  0.7],  // 12 - right shoulder (витягнута вперед)
       [0.0,  0.0,  0.0],  // 23 - left hip
       [0.0,  0.0,  0.0],  // 24 - right hip (опорна)
       [0.0, -0.1, -0.1],  // 25 - left knee
       [0.0, -0.5,  0.0],  // 26 - right knee (злегка зігнута або пряма)
       [0.0, -0.2, -0.8],  // 27 - left ankle (витягнута назад)
       [0.0, -1.0,  0.0],  // 28 - right ankle (опорна)
       ...
      ]
    ```

2.  **Матриця кутів, оптимізована через урахування анатомічних зв'язків:**
    *   **Ключові кути для Воїна III:**
        *   **Опорна нога:**
            *   Праве коліно (24-26-28): ~170-180 градусів (або ~160 для легкого згинання).
            *   Праве стегно (12-24-26): Кут згинання стегна, що дозволяє тулубу бути паралельним підлозі.
        *   **Витягнута нога:**
            *   Ліве коліно (23-25-27): ~170-180 градусів.
            *   Ліве стегно (11-23-25): Кут розгинання стегна, що дозволяє нозі бути паралельною підлозі.
        *   **Тулуб-Руки:**
            *   Кут між вектором тулуба (наприклад, 24-12) та горизонталлю: ~0-5 градусів.
            *   Лівий лікоть (11-13-15): ~170-180 градусів.
            *   Правий лікоть (12-14-16): ~170-180 градусів.
            *   Кут між вектором плеча (наприклад, 12-14) та горизонталлю: ~0-5 градусів.
    *   **Оптимізація через урахування анатомічних зв'язків:** Для "Пози Воїна III" критичними є лінійність тіла (голова-тулуб-нога), паралельність тулуба та витягнутої ноги до підлоги, а також кути в опорній нозі. Ми можемо використовувати:
        *   Кути в колінах (23-25-27, 24-26-28).
        *   Кут між вектором "тулуб-голова" (наприклад, 12-0) та вектором "тулуб-витягнута нога" (12-23), який має бути близьким до 180 градусів.
        *   Кут між вектором "тулуб-плече" (12-14) та вектором "тулуб-голова" (12-0), щоб оцінити витягування рук.
        *   Нахил тулуба (кут між вектором 24-12 та вектором 24-28).
    *   Приклад реальних значень кутів (у градусах) для правильної пози:
    ```
    M_angles_Warrior3 =
      [[angle(23-25-27), 175],  // Ліве коліно (витягнута нога)
       [angle(24-26-28), 165],  // Праве коліно (опорна, легкий згин)
       [angle(11-13-15), 175],  // Лівий лікоть
       [angle(12-14-16), 175],  // Правий лікоть
       [angle(0-24-27), 178],   // Кут лінійності тіла (Ніс - Праве стегно - Ліва щиколотка)
       [angle(24-12-11), 5],   // Кут нахилу тулуба (Праве стегно - Праве плече - Ліве плече)
       [angle(11-13-15), 5],   // Кут лівої руки (Ліве плече - Лівий лікоть - Ліве зап'ястя)
       [angle(12-14-16), 5]    // Кут правої руки (Праве плече - Правий лікоть - Праве зап'ястя)
      ]
    ```
    *   **Переваги матриці кутів:** Найкраще підходить для оцінки складної балансуючої пози, інваріантність до абсолютного положення.
    *   **Недоліки:** Чутливість до неточностей z-координат при обчисленні кутів, що лежать у площинах, перпендикулярних до камери.

### Переваги та недоліки різних варіантів опису

*   **Матриця координат суглобів:**
    *   **Переваги:** Простота, пряме використання вихідних даних.
    *   **Недоліки:** Сильна залежність від положення людини, низька стійкість до зсувів та обертань, що ускладнює порівняння поз. Висока чутливість до шуму.
*   **Матриця відносних векторів:**
    *   **Переваги:** Часткова інваріантність до трансляції, краще відображає форму тіла.
    *   **Недоліки:** Чутливість до загального обертання, все ще залежить від точності z-координат.
*   **Матриця кутів, оптимізована через урахування анатомічних зв'язків:**
    *   **Переваги:** Інваріантність до положення та обертання, найкраще підходить для порівняння поз незалежно від розміру людини. Зменшення розмірності та обчислювальної складності завдяки врахуванню анатомічних зв'язків.
    *   **Недоліки:** Обчислення кутів може бути складним і чутливим до похибок, особливо для малих кутів або коли суглоби знаходяться близько один до одного.

**Порівняльний аналіз:** Для проєкту "Віртуальна Йога" **матриця кутів (оптимізована)** є найбільш перспективним підходом. Вона забезпечує високу інваріантність, дозволяє фокусуватися на *формі* пози, а не на її абсолютному положенні. Комбінований підхід (Матриця координат для первинного позиціонування та Матриця кутів для детальної оцінки) може бути найефективнішим.

### Застосування вагового коефіцієнта `w` для z-координати в матричних описах
Для всіх 3D-представлень (матриця координат, матриця векторів, а також при обчисленні кутів, які залежать від z), необхідно застосовувати ваговий коефіцієнт `w < 1`.

*   **У матриці координат:** При розрахунку відстаней або порівнянні позицій, координати `z` можуть бути домножені на `w` (як у модифікованій формулі відстані `w(z₂-z₁)²`) перед виконанням операцій.
*   **У матриці векторів:** При обчисленні довжин векторів або їх порівнянні, компоненти `z` можуть бути зважені.
*   **При обчисленні кутів:** Кути розраховуються на основі векторів. Якщо вектори формуються з 3D-координат, то неточність `z` буде впливати на кут. Можливим підходом є використання "зважених" векторів для розрахунку кутів, або ж врахування коефіцієнта `w` при визначенні допустимої похибки для кутів, що знаходяться у площинах, перпендикулярних до камери.

## 5. Висновок
Адаптація матричної алгебри до завдань "Віртуальної Йоги" дозволяє створити надійну та гнучку систему аналізу поз. Використання оптимізованих матриць кутів, врахування анатомічних зв'язків та застосування вагових коефіцієнтів для компенсації обмежень вебкамери є ключовими для успішної реалізації проєкту. Це не тільки забезпечить точний зворотний зв'язок для користувачів, але й продемонструє студентам реальну цінність вищої математики в сучасних IT-розробках.
